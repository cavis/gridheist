// ==============================================================
// gridheist.js v0.0.4
// A jQuery plugin to hijack an image gallery, making it great.
// http://github.com/cavis/gridheist
// ==============================================================
// Copyright (c) 2013 cav.is
// Licensed under http:#en.wikipedia.org/wiki/MIT_License
// ==============================================================
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b=[].slice;!function(c,d){var e;return e=function(){function b(b,e){this.keyHandler=a(this.keyHandler,this),this.moveRight=a(this.moveRight,this),this.moveLeft=a(this.moveLeft,this),this.clickHandler=a(this.clickHandler,this);var f=this;this.options=c.extend({},this.defaults,e),this.options.thumbMaxHeight&&this.options.thumbMaxHeight<this.options.thumbMinHeight&&(this.options.thumbMinHeight=this.options.thumbMaxHeight),this.$el=c(b),this.$el.addClass("gridheist-gallery"),this.$el.on("click",".gridheist-thumb",this.clickHandler),this.$el.on("click",".gridheist-left",function(){return f.moveLeft()}),this.$el.on("click",".gridheist-right",function(){return f.moveRight()}),this.$el.on("click",".gridheist-close",function(){return f.closeExpander()}),this.update(),c(d).resize(function(){return f.width!==f.$el.width()?f.doLayout():void 0})}return b.prototype["public"]={update:!0},b.prototype.defaults={thumbSelector:"> *",thumbBorder:10,thumbMinHeight:200,thumbMaxHeight:null,preloadImages:!0,expander:!0,expandHeight:300,expandSideWidth:200,expandSideRender:!1},b.prototype.update=function(a){return null==a&&(a={}),c.extend(this.options,a),this.$thumbs&&this.$thumbs.unwrap(),this.$thumbs=this.$el.find(this.options.thumbSelector),this.$thumbs.addClass("gridheist-thumb"),this.$thumbs.wrapAll('<div class="gridheist-wrap"></div>'),this.$wrap=this.$el.find(".gridheist-wrap"),this.doLayout()},b.prototype.doLayout=function(){var a;return this.closeExpander(),this.width=this.$el.width(),this.$wrap.width(this.width),this.rows=[],a="0 "+this.options.thumbBorder+"px "+this.options.thumbBorder+"px 0",this.$thumbs.css("margin",a),this.processThumb(0,0,0)},b.prototype.processThumb=function(a,b,c){var d,e,f=this;return a<this.$thumbs.length?(e=this.$thumbs.eq(a),d=e.find("img"),this.getDimensions(d,function(g,h){return f.rows[b]||(f.rows[b]={thumbs:[],images:[],widths:[],heights:[]}),f.options.thumbMaxHeight&&h>f.options.thumbMaxHeight&&(g=Math.floor(f.options.thumbMaxHeight/h*g),h=f.options.thumbMaxHeight,d.attr("width",g),d.attr("height",h)),f.rows[b].thumbs.push(e),f.rows[b].images.push(d),f.rows[b].widths.push(g),f.rows[b].heights.push(h),e.data("row",b),0!==c&&(c+=f.options.thumbBorder),c+=g,c>=f.width?(f.layoutRow(b,c),f.processThumb(a+1,b+1,0)):f.processThumb(a+1,b,c)})):(this.rows[b]&&this.layoutRow(b,c),this.options.preloadImages?this.preload():void 0)},b.prototype.layoutRow=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(h=9999,p=this.rows[a].heights,f=l=0,n=p.length;n>l;f=++l)e=p[f],h>e&&(h=e);for(h=Math.max(this.options.thumbMinHeight,h),i=Math.max(b-this.width,0),q=this.rows[a].thumbs,r=[],f=m=0,o=q.length;o>m;f=++m)c=q[f],j=Math.ceil(i/(this.rows[a].thumbs.length-f)),i-=j,c.css("width",this.rows[a].widths[f]-j),c.css("height",h),d=Math.floor(j/2),k=Math.floor((this.rows[a].heights[f]-h)/2),this.rows[a].images[f].css("margin-left",-d),this.rows[a].images[f].css("margin-top",-k),f===this.rows[a].thumbs.length-1?(g="0 0 "+this.options.thumbBorder+"px 0",r.push(c.css("margin",g))):r.push(void 0);return r},b.prototype.getDimensions=function(a,b){var d,e,f;return(f=a.data("width"))&&(d=a.data("height"))?b(f,d):(e=new Image,c(e).load(function(){return a.data("width",e.width),a.data("height",e.height),b(e.width,e.height)}).error(function(){return console.error("An error occurred and your image could not be loaded.  Please try again."),b(100,100)}).attr({src:a.attr("src")}))},b.prototype.preload=function(){return this.$thumbs.each(function(a,b){return(new Image).src=c(b).attr("href")})},b.prototype.clickHandler=function(a){var b;return a.preventDefault(),b=c(a.currentTarget),this.options.expander&&!b.hasClass("expanded")?this.expandThumb(b):void 0},b.prototype.moveLeft=function(){var a,b;return a=this.$el.find(".gridheist-thumb.expanded"),b=a.prevAll(".gridheist-thumb").first(),b.length>0?this.expandThumb(b,"up"):this.closeExpander()},b.prototype.moveRight=function(){var a,b;return a=this.$el.find(".gridheist-thumb.expanded"),b=a.nextAll(".gridheist-thumb").first(),b.length>0?this.expandThumb(b,"down"):this.closeExpander()},b.prototype.keyHandler=function(a){var b;return b=a.keyCode||a.which,37===b&&this.moveLeft(),39===b&&this.moveRight(),27===b?this.closeExpander:void 0},b.prototype.expandThumb=function(a,b){var d,e,f,g,h,i,j,k;return null==b&&(b=null),i=a.data("row"),h=a.attr("href"),d=this.rows[i].thumbs[this.rows[i].thumbs.length-1],j=null,this.$el.find(".gridheist-thumb.expanded").removeClass("expanded"),a.addClass("expanded"),b&&(j=c("body").scrollTop(),g=this.options.thumbBorder+a.height(),"up"===b?j-=g:j+=g),this.$expander?this.$expander.prev().is(d)?(b=!1,this.$expander.html("")):(this.$expander.remove(),this.$expander=c('<div class="gridheist-expander"></div>')):(b=!1,this.$expander=c('<div class="gridheist-expander"></div>'),c(document).on("keydown",this.keyHandler)),this.$expander.css("margin-bottom",this.options.thumbBorder),this.$expander.css("height",this.options.expandHeight),this.options.expandSideRender&&(k=this.options.expandSideWidth,this.$expander.append('<div class="gridheist-expander-side" style="width:'+k+'px">\n  <div class="gridheist-expander-seperator"></div>\n  <div class="gridheist-expander-content">\n    '+this.options.expandSideRender(a)+"\n  </div>\n</div>")),e=a.position().left+a.width()/2,f=this.options.thumbBorder,this.$expander.append('<div class="gridheist-expander-arrow" style="left:'+e+"px;\n  border-width:"+f+"px; margin-left:-"+f+'px;">\n</div>\n<div class="gridheist-left">&lsaquo;</div>\n<div class="gridheist-right">&rsaquo;</div>\n<div class="gridheist-close">&times;</div>'),this.$expander.find(".gridheist-left, .gridheist-right, .gridheist-close").attr("unselectable","on").css("user-select","none").on("selectstart",!1),this.$expander.append('<div class="gridheist-expander-img">\n  <img src="'+h+'"/>\n</div>'),this.$expander.parent().length||d.after(this.$expander),b?c("body").scrollTop(j):void 0},b.prototype.closeExpander=function(){return this.$el.find(".expanded").removeClass("expanded"),this.$expander?(this.$expander.remove(),this.$expander=void 0,c(document).off("keydown",this.keyHandler)):void 0},b}(),c.fn.extend({gridHeist:function(){var a,d;return d=arguments[0],a=2<=arguments.length?b.call(arguments,1):[],this.each(function(){var b,f;return b=c(this),f=b.data("gridHeist"),f||b.data("gridHeist",f=new e(this,d)),"string"==typeof d&&f["public"][d]?f[d].apply(f,a):void 0})}})}(window.jQuery,window)}).call(this);